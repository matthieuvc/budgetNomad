class FlightsController < ApplicationController
  require 'uri'
  require 'net/http'
  require 'json'

  def index
    @offer = Offer.find(params[:offer])
    @departure_data = fetch_departures

    @return_data = fetch_returns

  end

  def new
    @flight = Flight.new
  end

  def create
    flight_details = {
      departure_outbound: flight_params["go_departure"].to_datetime,
      departure_inbound: flight_params["go_arrival"].to_datetime,
      depart_location: flight_params["go_departure_location"],
      arrival_location: flight_params["go_arrival_location"],
      return_outbound: flight_params["back_departure"].to_datetime,
      return_inbound: flight_params["back_arrival"].to_datetime,
      price: flight_params["price_per_passenger"].to_f
    }

    @flight = Flight.new(flight_details)
    @offer = Offer.find(params[:offer])
    @flight.offer = @offer
    @flight.save!

    redirect_to hotels_path(offer_id: @offer.id, flight_id: @flight.id)
  end

  private

  def flight_params
    params.require(:flight).permit(:go_departure, :go_departure_location, :go_arrival, :go_arrival_location, :back_departure, :back_arrival, :price_per_passenger)
  end

  def source_airport_code
    localisation = @offer.localisation
    url = URI("https://tripadvisor16.p.rapidapi.com/api/v1/flights/searchAirport?query=#{localisation}")

    http = Net::HTTP.new(url.host, url.port)
    http.use_ssl = true

    request = Net::HTTP::Get.new(url)
    request["X-RapidAPI-Key"] = 'b4b3100277mshe0370ca0aea55ddp14b73bjsn4164eba75913'
    request["X-RapidAPI-Host"] = 'tripadvisor16.p.rapidapi.com'

    airport_response1 = http.request(request).read_body
    airport = JSON.parse(airport_response1)

    return airport["data"][0]["airportCode"]
  end

  def destination_airport_code
    destination = @offer.destination
    url = URI("https://tripadvisor16.p.rapidapi.com/api/v1/flights/searchAirport?query=#{destination}")

    http = Net::HTTP.new(url.host, url.port)
    http.use_ssl = true

    request = Net::HTTP::Get.new(url)
    request["X-RapidAPI-Key"] = 'b4b3100277mshe0370ca0aea55ddp14b73bjsn4164eba75913'
    request["X-RapidAPI-Host"] = 'tripadvisor16.p.rapidapi.com'

    airport_response2 = http.request(request).read_body
    airport2 = JSON.parse(airport_response2)

    return airport2["data"][0]["airportCode"]
  end

 def fetch_flights
    url = URI("https://tripadvisor16.p.rapidapi.com/api/v1/flights/searchFlights?sourceAirportCode=#{source_airport_code}&destinationAirportCode=#{destination_airport_code}&date=#{@offer.start_date}&itineraryType=ROUND_TRIP&sortOrder=PRICE&numAdults=1&numSeniors=0&classOfService=ECONOMY&returnDate=#{@offer.end_date}&pageNumber=1&currencyCode=USD")
    http = Net::HTTP.new(url.host, url.port)
    http.use_ssl = true

    request = Net::HTTP::Get.new(url)
    request["X-RapidAPI-Key"] = '503a48dfecmsh69c31a138b3f12dp189e0bjsn731e815fb930'
    request["X-RapidAPI-Host"] = 'tripadvisor16.p.rapidapi.com'
    flight_response = http.request(request).read_body
    flights = JSON.parse(flight_response)

    #flights2 = {"status"=>true, "message"=>"Success", "timestamp"=>1686578316004, "data"=>{"session"=>{"searchHash"=>"f49868b91a12a82cb7f33caeed6d5ecc", "pageLoadUid"=>"8c4d4429-7330-413b-a410-47ae071eef10", "searchId"=>"f139f217-9d9b-455a-9b2b-6ffc9fe40156.464"}, "complete"=>true, "numOfFilters"=>1178, "totalNumResults"=>1465, "flights"=>[{"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T15:30:00+02:00", "arrivalDateTime"=>"2023-06-13T18:05:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"TB", "operatingCarrierCode"=>"TB", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>1417, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}, "marketingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T21:50:00+02:00", "arrivalDateTime"=>"2023-06-13T22:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>6361, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>225}]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T07:55:00+02:00", "arrivalDateTime"=>"2023-06-14T08:50:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>2495, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>350}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|29", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>202.97, "totalPricePerPassenger"=>202.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24914", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|29&area=FLTCenterColumn|1|1|ItinList|2|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24914&totalPricePerPassenger=202.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T15:30:00+02:00", "arrivalDateTime"=>"2023-06-13T18:05:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"TB", "operatingCarrierCode"=>"TB", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>1417, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}, "marketingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T21:50:00+02:00", "arrivalDateTime"=>"2023-06-13T22:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>6361, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>225}]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T08:40:00+02:00", "arrivalDateTime"=>"2023-06-14T09:25:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"UX", "operatingCarrierCode"=>"UX", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>6007, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729002, "code"=>"UX", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirEuropa2.png", "displayName"=>"Air Europa"}, "marketingCarrier"=>{"locationId"=>8729002, "code"=>"UX", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirEuropa2.png", "displayName"=>"Air Europa"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>315}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|43", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>220.97, "totalPricePerPassenger"=>220.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24915", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|43&area=FLTCenterColumn|1|1|ItinList|3|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24915&totalPricePerPassenger=220.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T18:10:00+02:00", "arrivalDateTime"=>"2023-06-13T20:20:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A320 (sharklets)", "amenities"=>[], "flightNumber"=>8983, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T07:55:00+02:00", "arrivalDateTime"=>"2023-06-14T08:50:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>2495, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>350}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|180", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>222.97, "totalPricePerPassenger"=>222.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24916", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|180&area=FLTCenterColumn|1|1|ItinList|4|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24916&totalPricePerPassenger=222.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T18:10:00+02:00", "arrivalDateTime"=>"2023-06-13T20:20:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A320 (sharklets)", "amenities"=>[], "flightNumber"=>8983, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T06:30:00+02:00", "arrivalDateTime"=>"2023-06-14T07:25:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>1342, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>435}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|24", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>222.97, "totalPricePerPassenger"=>222.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24917", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|24&area=FLTCenterColumn|1|1|ItinList|6|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24917&totalPricePerPassenger=222.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T18:10:00+02:00", "arrivalDateTime"=>"2023-06-13T20:20:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A320 (sharklets)", "amenities"=>[], "flightNumber"=>8983, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T12:15:00+02:00", "arrivalDateTime"=>"2023-06-14T14:30:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2918, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|147", "providerId"=>"Gotogate", "partnerSuppliedProvider"=>{"id"=>"GOTOGATE", "displayName"=>"Gotogate", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/GOTOGATE.png?crop=false&width=166&height=62&fallback=default3.png&_v=a29de71af6666a1a11e42eb0b5f7f84a"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>237.97, "totalPricePerPassenger"=>237.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24918", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|147&area=FLTCenterColumn|1|1|ItinList|7|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24918&totalPricePerPassenger=237.97"}, {"purchaseLinkId"=>"Kayak|4|148", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOM", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>238.97, "totalPricePerPassenger"=>238.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24919", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|148&area=FLTCenterColumn|1|1|ItinList|7|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24919&totalPricePerPassenger=238.97"}, {"purchaseLinkId"=>"Kayak|4|149", "providerId"=>"eDreams", "partnerSuppliedProvider"=>{"id"=>"EDREAMSAIR", "displayName"=>"eDreams", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/EDREAMSAIR.us.png?crop=false&width=166&height=62&fallback=default2.png&_v=af0479a857c0eb142b1531d305bbf971"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>245.14, "totalPricePerPassenger"=>245.14, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24920", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|149&area=FLTCenterColumn|1|1|ItinList|7|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24920&totalPricePerPassenger=245.14"}, {"purchaseLinkId"=>"Kayak|4|150", "providerId"=>"Booking.com", "partnerSuppliedProvider"=>{"id"=>"BOOKINGFLIGHTS", "displayName"=>"Booking.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/BOOKINGFLIGHTS.png?crop=false&width=166&height=62&fallback=default3.png&_v=9d698de13331f20432214de1f7f5fab5"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>246.97, "totalPricePerPassenger"=>246.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24921", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|150&area=FLTCenterColumn|1|1|ItinList|7|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24921&totalPricePerPassenger=246.97"}, {"purchaseLinkId"=>"Kayak|4|151", "providerId"=>"Kiwi.com", "partnerSuppliedProvider"=>{"id"=>"SKYPICKER", "displayName"=>"Kiwi.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/SKYPICKER.png?crop=false&width=166&height=62&fallback=default3.png&_v=0cd3e94b7e8a5f027bff27942a213709"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>253, "totalPricePerPassenger"=>253, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24922", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|151&area=FLTCenterColumn|1|1|ItinList|7|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24922&totalPricePerPassenger=253"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T15:30:00+02:00", "arrivalDateTime"=>"2023-06-13T18:05:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"TB", "operatingCarrierCode"=>"TB", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>1417, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}, "marketingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T21:50:00+02:00", "arrivalDateTime"=>"2023-06-13T22:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>6361, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>225}]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T11:55:00+02:00", "arrivalDateTime"=>"2023-06-14T12:40:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"UX", "operatingCarrierCode"=>"UX", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>6037, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729002, "code"=>"UX", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirEuropa2.png", "displayName"=>"Air Europa"}, "marketingCarrier"=>{"locationId"=>8729002, "code"=>"UX", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirEuropa2.png", "displayName"=>"Air Europa"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>120}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|44", "providerId"=>"Kiwi.com", "partnerSuppliedProvider"=>{"id"=>"KIWIVI", "displayName"=>"Kiwi.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/SKYPICKER.png?crop=false&width=166&height=62&fallback=default3.png&_v=0cd3e94b7e8a5f027bff27942a213709"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>232, "totalPricePerPassenger"=>232, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24923", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|44&area=FLTCenterColumn|1|1|ItinList|8|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24923&totalPricePerPassenger=232"}, {"purchaseLinkId"=>"Kayak|4|45", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>233.97, "totalPricePerPassenger"=>233.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24924", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|45&area=FLTCenterColumn|1|1|ItinList|8|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24924&totalPricePerPassenger=233.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T09:45:00+02:00", "arrivalDateTime"=>"2023-06-13T11:55:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A321-100/200", "amenities"=>[], "flightNumber"=>8981, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T07:55:00+02:00", "arrivalDateTime"=>"2023-06-14T08:50:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>2495, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>350}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|65", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>234.97, "totalPricePerPassenger"=>234.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24925", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|65&area=FLTCenterColumn|1|1|ItinList|9|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24925&totalPricePerPassenger=234.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T09:45:00+02:00", "arrivalDateTime"=>"2023-06-13T11:55:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A321-100/200", "amenities"=>[], "flightNumber"=>8981, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T06:30:00+02:00", "arrivalDateTime"=>"2023-06-14T07:25:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>1342, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T14:40:00+02:00", "arrivalDateTime"=>"2023-06-14T17:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2916, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>435}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|111", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>234.97, "totalPricePerPassenger"=>234.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24926", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|111&area=FLTCenterColumn|1|1|ItinList|10|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24926&totalPricePerPassenger=234.97"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T18:10:00+02:00", "arrivalDateTime"=>"2023-06-13T20:20:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A320 (sharklets)", "amenities"=>[], "flightNumber"=>8983, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T15:30:00+02:00", "arrivalDateTime"=>"2023-06-14T17:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2922, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|172", "providerId"=>"Gotogate", "partnerSuppliedProvider"=>{"id"=>"GOTOGATE", "displayName"=>"Gotogate", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/GOTOGATE.png?crop=false&width=166&height=62&fallback=default3.png&_v=a29de71af6666a1a11e42eb0b5f7f84a"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>236.97, "totalPricePerPassenger"=>236.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24927", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|172&area=FLTCenterColumn|1|1|ItinList|12|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24927&totalPricePerPassenger=236.97"}, {"purchaseLinkId"=>"Kayak|4|173", "providerId"=>"eDreams", "partnerSuppliedProvider"=>{"id"=>"EDREAMSAIR", "displayName"=>"eDreams", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/EDREAMSAIR.us.png?crop=false&width=166&height=62&fallback=default2.png&_v=af0479a857c0eb142b1531d305bbf971"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>243.99, "totalPricePerPassenger"=>243.99, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24928", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|173&area=FLTCenterColumn|1|1|ItinList|12|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24928&totalPricePerPassenger=243.99"}, {"purchaseLinkId"=>"Kayak|4|174", "providerId"=>"Booking.com", "partnerSuppliedProvider"=>{"id"=>"BOOKINGFLIGHTS", "displayName"=>"Booking.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/BOOKINGFLIGHTS.png?crop=false&width=166&height=62&fallback=default3.png&_v=9d698de13331f20432214de1f7f5fab5"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>245.97, "totalPricePerPassenger"=>245.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24929", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|174&area=FLTCenterColumn|1|1|ItinList|12|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24929&totalPricePerPassenger=245.97"}, {"purchaseLinkId"=>"Kayak|4|175", "providerId"=>"Kiwi.com", "partnerSuppliedProvider"=>{"id"=>"SKYPICKER", "displayName"=>"Kiwi.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/SKYPICKER.png?crop=false&width=166&height=62&fallback=default3.png&_v=0cd3e94b7e8a5f027bff27942a213709"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>252, "totalPricePerPassenger"=>252, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24930", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|175&area=FLTCenterColumn|1|1|ItinList|12|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24930&totalPricePerPassenger=252"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"PMI", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T15:30:00+02:00", "arrivalDateTime"=>"2023-06-13T18:05:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"TB", "operatingCarrierCode"=>"TB", "equipmentId"=>"Boeing 737 MAX 8", "amenities"=>[], "flightNumber"=>1417, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1270.7242, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}, "marketingCarrier"=>{"locationId"=>8869165, "code"=>"TB", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Jetairfly.png", "displayName"=>"TUIfly"}}, {"originStationCode"=>"PMI", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T21:50:00+02:00", "arrivalDateTime"=>"2023-06-13T22:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>6361, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>202.09299, "isInternational"=>false, "selfTransfer"=>true, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>225}]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T12:15:00+02:00", "arrivalDateTime"=>"2023-06-14T14:30:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2918, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|4|139", "providerId"=>"mytrip.com", "partnerSuppliedProvider"=>{"id"=>"AIRTICKETS24DOTCOMVI", "displayName"=>"mytrip.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/AIRTICKETS24DOTCOM.png?crop=false&width=166&height=62&fallback=default1.png&_v=1e84439f35e4558f94e874158f6a3eae"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>237.97, "totalPricePerPassenger"=>237.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24931", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|139&area=FLTCenterColumn|1|1|ItinList|13|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24931&totalPricePerPassenger=237.97"}, {"purchaseLinkId"=>"Kayak|4|140", "providerId"=>"Kiwi.com", "partnerSuppliedProvider"=>{"id"=>"KIWIVI", "displayName"=>"Kiwi.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/SKYPICKER.png?crop=false&width=166&height=62&fallback=default3.png&_v=0cd3e94b7e8a5f027bff27942a213709"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>244, "totalPricePerPassenger"=>244, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24932", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|4|140&area=FLTCenterColumn|1|1|ItinList|13|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24932&totalPricePerPassenger=244"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BCN", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T09:45:00+02:00", "arrivalDateTime"=>"2023-06-13T11:55:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"VY", "operatingCarrierCode"=>"VY", "equipmentId"=>"Airbus A321-100/200", "amenities"=>[], "flightNumber"=>8981, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}, "marketingCarrier"=>{"locationId"=>8729185, "code"=>"VY", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Vueling.png", "displayName"=>"Vueling"}}], "layovers"=>[]}, {"legs"=>[{"originStationCode"=>"BCN", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T15:30:00+02:00", "arrivalDateTime"=>"2023-06-14T17:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"FR", "operatingCarrierCode"=>"FR", "equipmentId"=>"Boeing 737-800 (winglets)", "amenities"=>[], "flightNumber"=>2922, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>1084.8345, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}, "marketingCarrier"=>{"locationId"=>8729141, "code"=>"FR", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Ryanair"}}], "layovers"=>[]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|3|1332", "providerId"=>"Gotogate", "partnerSuppliedProvider"=>{"id"=>"GOTOGATE", "displayName"=>"Gotogate", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/GOTOGATE.png?crop=false&width=166&height=62&fallback=default3.png&_v=a29de71af6666a1a11e42eb0b5f7f84a"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>247.97, "totalPricePerPassenger"=>247.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24933", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|3|1332&area=FLTCenterColumn|1|1|ItinList|14|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24933&totalPricePerPassenger=247.97"}, {"purchaseLinkId"=>"Kayak|3|1333", "providerId"=>"eDreams", "partnerSuppliedProvider"=>{"id"=>"EDREAMSAIR", "displayName"=>"eDreams", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/EDREAMSAIR.us.png?crop=false&width=166&height=62&fallback=default2.png&_v=af0479a857c0eb142b1531d305bbf971"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>255.1, "totalPricePerPassenger"=>255.1, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24934", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|3|1333&area=FLTCenterColumn|1|1|ItinList|14|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24934&totalPricePerPassenger=255.1"}, {"purchaseLinkId"=>"Kayak|3|1334", "providerId"=>"Booking.com", "partnerSuppliedProvider"=>{"id"=>"BOOKINGFLIGHTS", "displayName"=>"Booking.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/BOOKINGFLIGHTS.png?crop=false&width=166&height=62&fallback=default3.png&_v=9d698de13331f20432214de1f7f5fab5"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>256.97, "totalPricePerPassenger"=>256.97, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24935", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|3|1334&area=FLTCenterColumn|1|1|ItinList|14|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24935&totalPricePerPassenger=256.97"}, {"purchaseLinkId"=>"Kayak|3|1335", "providerId"=>"Kiwi.com", "partnerSuppliedProvider"=>{"id"=>"SKYPICKER", "displayName"=>"Kiwi.com", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/SKYPICKER.png?crop=false&width=166&height=62&fallback=default3.png&_v=0cd3e94b7e8a5f027bff27942a213709"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>263, "totalPricePerPassenger"=>263, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "impressionId"=>"a60c4356-447d-4a63-b9d3-0eda2e863fd3.24936", "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=f49868b91a12a82cb7f33caeed6d5ecc&provider=Kayak|3|1335&area=FLTCenterColumn|1|1|ItinList|14|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=a60c4356-447d-4a63-b9d3-0eda2e863fd3.24936&totalPricePerPassenger=263"}]}]}}

    #flights = {"status"=>true, "message"=>"Success", "timestamp"=>1686572086255, "data"=>{"session"=>{"searchHash"=>"a485b9fad41f386c1fe32fb7dccdcda5", "pageLoadUid"=>"13fcf1f6-1da5-48f1-831e-a9339b7a78ce", "searchId"=>"b68053dd-c534-4553-93ea-9ae122a19fc9.369"}, "complete"=>false, "numOfFilters"=>3, "totalNumResults"=>3, "flights"=>[{"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"FRA", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T14:40:00+02:00", "arrivalDateTime"=>"2023-06-12T15:40:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"CL", "equipmentId"=>"Embraer 190", "amenities"=>[], "flightNumber"=>1013, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>304.0784, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>0, "code"=>"CL", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Lufthansa CityLine"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"FRA", "isDifferentOriginStation"=>false, "destinationStationCode"=>"DEL", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T21:15:00+02:00", "arrivalDateTime"=>"2023-06-13T08:30:00+05:30", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"AI", "equipmentId"=>"Boeing 787-8 Dreamliner", "amenities"=>[], "flightNumber"=>7252, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>6128.8745, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729004, "code"=>"AI", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirIndia.png", "displayName"=>"Air India"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>335}]}, {"legs"=>[{"originStationCode"=>"DEL", "isDifferentOriginStation"=>false, "destinationStationCode"=>"FRA", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T13:35:00+05:30", "arrivalDateTime"=>"2023-06-13T18:40:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"AI", "equipmentId"=>"Boeing 787-8 Dreamliner", "amenities"=>[], "flightNumber"=>7253, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>6128.8745, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729004, "code"=>"AI", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirIndia.png", "displayName"=>"Air India"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"FRA", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T06:40:00+02:00", "arrivalDateTime"=>"2023-06-14T07:35:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"LH", "equipmentId"=>"Airbus A320-100/200", "amenities"=>[], "flightNumber"=>1004, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>304.0784, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>720}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|1|3", "providerId"=>"Priceline", "partnerSuppliedProvider"=>{"id"=>"PRICELINEFLIGHTS", "displayName"=>"Priceline", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/PRICELINEFLIGHTS.png?crop=false&width=166&height=62&fallback=default3.png&_v=b3e81884c7678f954cce1ed2c441273a"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>1268.44, "totalPricePerPassenger"=>1268.44, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=a485b9fad41f386c1fe32fb7dccdcda5&provider=Kayak|1|3&area=FLTCenterColumn|0|1|ItinList|2|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=&totalPricePerPassenger=1268.44"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"FRA", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T18:05:00+02:00", "arrivalDateTime"=>"2023-06-12T19:05:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"LH", "equipmentId"=>"Airbus A320 (sharklets)", "amenities"=>[], "flightNumber"=>1017, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>304.0784, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"FRA", "isDifferentOriginStation"=>false, "destinationStationCode"=>"DEL", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T21:15:00+02:00", "arrivalDateTime"=>"2023-06-13T08:30:00+05:30", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"AI", "equipmentId"=>"Boeing 787-8 Dreamliner", "amenities"=>[], "flightNumber"=>7252, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>6128.8745, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729004, "code"=>"AI", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirIndia.png", "displayName"=>"Air India"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>130}]}, {"legs"=>[{"originStationCode"=>"DEL", "isDifferentOriginStation"=>false, "destinationStationCode"=>"FRA", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T13:35:00+05:30", "arrivalDateTime"=>"2023-06-13T18:40:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"AI", "equipmentId"=>"Boeing 787-8 Dreamliner", "amenities"=>[], "flightNumber"=>7253, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>6128.8745, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729004, "code"=>"AI", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirIndia.png", "displayName"=>"Air India"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"FRA", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T09:40:00+02:00", "arrivalDateTime"=>"2023-06-14T10:35:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"LH", "equipmentId"=>"Airbus A319", "amenities"=>[], "flightNumber"=>1008, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>304.0784, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>900}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|1|2", "providerId"=>"Priceline", "partnerSuppliedProvider"=>{"id"=>"PRICELINEFLIGHTS", "displayName"=>"Priceline", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/PRICELINEFLIGHTS.png?crop=false&width=166&height=62&fallback=default3.png&_v=b3e81884c7678f954cce1ed2c441273a"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>1282.14, "totalPricePerPassenger"=>1282.14, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=a485b9fad41f386c1fe32fb7dccdcda5&provider=Kayak|1|2&area=FLTCenterColumn|0|1|ItinList|3|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=&totalPricePerPassenger=1282.14"}]}, {"segments"=>[{"legs"=>[{"originStationCode"=>"BRU", "isDifferentOriginStation"=>false, "destinationStationCode"=>"MUC", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T16:30:00+02:00", "arrivalDateTime"=>"2023-06-12T17:45:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"LH", "equipmentId"=>"Airbus A320 (sharklets)", "amenities"=>[], "flightNumber"=>2289, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>597.2947, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"MUC", "isDifferentOriginStation"=>false, "destinationStationCode"=>"FRA", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T19:00:00+02:00", "arrivalDateTime"=>"2023-06-12T20:00:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"LH", "equipmentId"=>"Airbus A321-100/200", "amenities"=>[], "flightNumber"=>119, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>300.17743, "isInternational"=>false, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"FRA", "isDifferentOriginStation"=>false, "destinationStationCode"=>"DEL", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-12T21:15:00+02:00", "arrivalDateTime"=>"2023-06-13T08:30:00+05:30", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"AI", "equipmentId"=>"Boeing 787-8 Dreamliner", "amenities"=>[], "flightNumber"=>7252, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>6128.8745, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729004, "code"=>"AI", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirIndia.png", "displayName"=>"Air India"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}], "layovers"=>[{"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>75}, {"durationType"=>"NORMAL", "hasStationChange"=>false, "durationInMinutes"=>75}]}, {"legs"=>[{"originStationCode"=>"DEL", "isDifferentOriginStation"=>false, "destinationStationCode"=>"FRA", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-13T13:35:00+05:30", "arrivalDateTime"=>"2023-06-13T18:40:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"AI", "equipmentId"=>"Boeing 787-8 Dreamliner", "amenities"=>[], "flightNumber"=>7253, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>6128.8745, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>8729004, "code"=>"AI", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/AirIndia.png", "displayName"=>"Air India"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}, {"originStationCode"=>"FRA", "isDifferentOriginStation"=>false, "destinationStationCode"=>"BRU", "isDifferentDestinationStation"=>false, "departureDateTime"=>"2023-06-14T11:30:00+02:00", "arrivalDateTime"=>"2023-06-14T12:25:00+02:00", "classOfService"=>"ECONOMY", "marketingCarrierCode"=>"LH", "operatingCarrierCode"=>"CL", "equipmentId"=>"Embraer 190", "amenities"=>[], "flightNumber"=>1010, "seatGuruEquipmentId"=>0, "seatGuruAirlineUrl"=>"", "numStops"=>0, "distanceInKM"=>304.0784, "isInternational"=>true, "selfTransfer"=>false, "operatingCarrier"=>{"locationId"=>0, "code"=>"CL", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/api_default.png", "displayName"=>"Lufthansa CityLine"}, "marketingCarrier"=>{"locationId"=>8729113, "code"=>"LH", "logoUrl"=>"https://static.tacdn.com/img2/flights/airlines/logos/100x100/Lufthansa_02.png", "displayName"=>"Lufthansa"}}], "layovers"=>[{"durationType"=>"LONG", "hasStationChange"=>false, "durationInMinutes"=>1010}]}], "purchaseLinks"=>[{"purchaseLinkId"=>"Kayak|1|1", "providerId"=>"Priceline", "partnerSuppliedProvider"=>{"id"=>"PRICELINEFLIGHTS", "displayName"=>"Priceline", "logoUrl"=>"https://content.r9cdn.net/rimg/provider-logos/airlines/h/PRICELINEFLIGHTS.png?crop=false&width=166&height=62&fallback=default3.png&_v=b3e81884c7678f954cce1ed2c441273a"}, "commerceName"=>"KayakFlightsMeta", "currency"=>"USD", "originalCurrency"=>"USD", "seatAvailability"=>0, "taxesAndFees"=>0, "taxesAndFeesPerPassenger"=>0, "totalPrice"=>1299.84, "totalPricePerPassenger"=>1299.84, "fareBasisCodes"=>[], "containedPurchaseLinks"=>[], "partnerData"=>{}, "isPaid"=>false, "fareAttributesList"=>[], "url"=>"https://www.tripadvisor.com/CheapFlightsPartnerHandoff?searchHash=a485b9fad41f386c1fe32fb7dccdcda5&provider=Kayak|1|1&area=FLTCenterColumn|0|1|ItinList|4|Meta_ItineraryPrice&resultsServlet=CheapFlightsSearchResults&handoffPlatform=desktop&impressionId=&totalPricePerPassenger=1299.84"}]}]}}

 end

 def fetch_departures
  flights = fetch_flights
    departure_data = flights["data"]["flights"].first(10).map do |flight|
        if flight["segments"][0]["layovers"].empty?
          {
            go_departure: flight["segments"][0]["legs"][0]["departureDateTime"],
            go_departure_location: flight["segments"][0]["legs"][0]["originStationCode"],
            go_layover_location: "",
            go_arrival: flight["segments"][0]["legs"][0]["arrivalDateTime"],
            go_arrival_location: flight["segments"][0]["legs"][0]["destinationStationCode"],
            price_per_passenger: flight["purchaseLinks"][0]["totalPrice"]



          }
        else
          { go_departure: flight["segments"][0]["legs"][0]["departureDateTime"],
            go_departure_location: flight["segments"][0]["legs"][0]["originStationCode"],
            go_layover_location: flight["segments"][0]["legs"][1]["originStationCode"],
            go_arrival: flight["segments"][0]["legs"][1]["arrivalDateTime"],
            go_arrival_location: flight["segments"][0]["legs"][1]["destinationStationCode"],
            price_per_passenger: flight["purchaseLinks"][0]["totalPrice"]
          }
        end
    end
  end

  def fetch_returns

    flights = fetch_flights
    return_data = flights["data"]["flights"].first(10).map do |flight|
      if flight["segments"][1]["layovers"].empty?
        { back_departure: flight["segments"][1]["legs"][0]["departureDateTime"],
          back_departure_location: flight["segments"][1]["legs"][0]["originStationCode"],
          back_layover_location: "",
          back_arrival: flight["segments"][1]["legs"][0]["arrivalDateTime"],
          back_arrival_location: flight["segments"][1]["legs"][0]["destinationStationCode"]
         }
      else
        {
          back_departure: flight["segments"][1]["legs"][0]["departureDateTime"],
          back_departure_location: flight["segments"][1]["legs"][0]["originStationCode"],
          back_layover_location: flight["segments"][1]["legs"][1]["originStationCode"],
          back_arrival: flight["segments"][1]["legs"][1]["arrivalDateTime"],
          back_arrival_location: flight["segments"][1]["legs"][1]["destinationStationCode"]
        }
      end
  end

 end

#   def create_flight(source_code, destination_code, date)
#     # this is just a comment
#     fetch_flights(source_code, destination_code, date)
end
